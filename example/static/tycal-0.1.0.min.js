(function(){"use strict";function t(t,e){return e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e}function e(t){var e=[6,0,1,2,3,4,5];return e[t.getDay()]}function o(t){var e=new Date(t);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e}function i(t){var e=new Date(t);e.setHours(0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));var o=new Date(e.getFullYear(),0,1);return Math.ceil(((e-o)/864e5+1)/7)}function n(t){t&&t.firstChild&&(t.removeChild(t.firstChild),n(t))}function s(t,e,o,i,n){var s,r;o||(o={}),-1!==e.indexOf(".")&&(r=e.split("."),e=r[0],r.shift(),o["class"]=r.join(" ")),-1!==e.indexOf("#")&&(r=e.split("#"),e=r[0],o.id=r[1]),s="svg"==t?document.createElementNS("http://www.w3.org/2000/svg",e):document.createElement(e);for(var a in o)s.setAttribute(a,o[a]);return i&&i.appendChild(s),n&&(s.innerHTML=n),s}function r(t){return"[object touchevent]"==t.toString().toLowerCase()}function a(t){return parseInt(t,10)}function h(t,e){!t||0===t.length&&t!=window||(t.length?Array.prototype.forEach.call(t,function(t){e(t)}):e(t))}function l(t,e,o,i){h(t,function(t){var n=e.split(" ");for(var s in n)t.addEventListener(n[s],o,i)})}function p(t,e,o){h(t,function(t){t.setAttribute(e,o)})}function d(t,e,o){return a((t.offsetWidth+e)/o)-1}function c(t,e,o){return a((t.offsetWidth+e+o)/(8*o))-1}function f(t){void 0===t&&(t={});var e={};for(var o in x)e[o]=void 0!==t[o]?t[o]:x[o];return e}function y(t){var e=u(t.currentTarget);return r(t)?{x:t.layerX,y:t.layerY}:{x:t.pageX-e.x,y:t.pageY-e.y}}function u(t){for(var e={x:0,y:0};t;)e.x+=t.offsetLeft-t.scrollLeft+t.clientLeft,e.y+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return e}var m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],D=["M","T","W","T","F","S","S"],v=function(t){this.ref=t};v.prototype.drawDays=function(t){for(var e in t)this.drawDay(t[e])},v.prototype.drawMonths=function(t){for(var e in t)this.drawMonth(t[e])},v.prototype.createElement=function(t,e,o,i){return s(this.graphics,t,e,o,i)};var g=t(v,function(t){this.graphics="svg",v.call(this,t)});g.prototype.drawDay=function(t){var e=this.ref.element.querySelector('[x="'+t.coord.x+'"][y="'+t.coord.y+'"]');if(!e){var o={x:t.coord.x,y:t.coord.y,width:t.coord.w,height:t.coord.h,"class":"tycal-day"};e=this.createElement("rect",o,this.ref.dayGroup)}this.ref.opt.onSetDayColor&&(e.style.fill=this.ref.opt.onSetDayColor(t)),this.ref.opt.onDrawDay&&this.ref.opt.onDrawDay(t,e)},g.prototype.resetDays=function(){this.ref.dayGroup||(this.ref.dayGroup=this.createElement("g",null,this.ref.element)),n(this.ref.dayGroup)},g.prototype.drawHover=function(t){var e=this.ref.element.querySelector('[x="'+t.coord.x+'"][y="'+t.coord.y+'"]');e&&(e.style.fill="rgba(0,0,0,0.5)")},g.prototype.setDimensions=function(t,e){p(this.ref.element,"width",t),p(this.ref.element,"height",e)};var w=t(v,function(t){v.call(this,t)});w.prototype.drawDay=function(t){this.ref.opt.onSetDayColor&&(this.ref.context.fillStyle=this.ref.opt.onSetDayColor(t)),this.ref.opt.onDrawDay&&this.ref.opt.onDrawDay(t,this.ref.context),this.ref.context.clearRect(t.coord.x-this.ref.opt.padding,t.coord.y-this.ref.opt.padding,t.coord.w+2*this.ref.opt.padding,t.coord.h+2*this.ref.opt.padding),this.ref.context.fillRect(t.coord.x,t.coord.y,t.coord.w,t.coord.h)},w.prototype.drawHover=function(t){this.ref.context.fillStyle="rgba(0,0,0,0.5)",this.ref.context.fillRect(t.coord.x,t.coord.y,t.coord.w,t.coord.h)},w.prototype.resetDays=function(){this.ref.context.clearRect(0,0,this.ref.element.width,this.ref.element.height)},w.prototype.drawMonth=function(t){this.ref.opt.onSetMonthColor&&(this.ref.context.fillStyle=this.ref.opt.onSetMonthColor(t)),this.ref.opt.onDrawMonth&&this.ref.opt.onDrawMonth(t,this.ref.context),this.ref.context.clearRect(t.coord.x-this.ref.opt.padding,t.coord.y-this.ref.opt.padding,t.coord.w+2*this.ref.opt.padding,t.coord.h+2*this.ref.opt.padding),this.ref.context.fillRect(t.coord.x,t.coord.y,t.coord.w,t.coord.h)},w.prototype.setDimensions=function(t,e){var o=window.devicePixelRatio||1;p(this.ref.element,"width",t*o),p(this.ref.element,"height",e*o),this.ref.element.style.width=t+"px",this.ref.element.style.height=e+"px",this.ref.context.scale(o,o)};var x={container:null,startDate:null,stopDate:null,date:null,expandFrom:"right",type:"week",graphics:"canvas",padding:1,cellSize:10,onSetDayColor:null,onSetDayTooltip:null,onDrawDay:null,onDrawMonthName:null,onDayHover:null,onPopulateDaysFinished:null},S=function(t){if(t.container){this.opt=f(t),this.opt.date=o(this.opt.date),"svg"==this.opt.graphics?(this.renderer=new g(this),this.element=this.renderer.createElement("svg",null,this.opt.container)):(this.renderer=new w(this),this.element=this.renderer.createElement("canvas",null,this.opt.container),this.context=this.element.getContext("2d")),this.tooltipElement=s(null,"div.tycal-tooltip",null,this.opt.container);var e=this;l(this.element,"touchstart mouseenter",function(t){e.isPressing=!0,e.hoverTimeout=setTimeout(function(){e.isPressing&&(e.isHovering=!0,e.move(t))},r(t)?300:0)}),l(this.element,"touchmove mousemove",function(t){e.isHovering&&(r(t)&&t.preventDefault(),e.move(t))}),l(this.element,"touchend mouseleave",function(t){e.isHovering=!1,setTimeout(function(){e.isPressing=!1,e.lastDayHovered&&e.renderer.drawDay(e.lastDayHovered),e.lastDayHovered=null,e.tooltipElement.style.display="none",e.hoverTimeout&&clearTimeout(e.hoverTimeout)},r(t)?10:0)}),l(window,"resize orientationchange",function(){e.draw()}),this.draw()}};S.prototype.setDate=function(t){this.opt.date=t,this.draw(!0)},S.prototype.getDate=function(){return this.opt.date},S.prototype.move=function(t){var e=y(t);if(!isNaN(e.x)&&!isNaN(e.y))for(var o in this.days){var i=this.days[o],n=e.x>=i.coord.x&&e.x<=i.coord.x+this.opt.cellSize,s=e.y>=i.coord.y&&e.y<=i.coord.y+this.opt.cellSize;if(n&&s){if(this.lastDayHovered==i)break;this.lastDayHovered&&this.renderer.drawDay(this.lastDayHovered),this.opt.onDayHover?this.opt.onDayHover(i,this.context):this.renderer.drawHover(i),this.drawTooltip(i),this.lastDayHovered=i;break}}},S.prototype.drawTooltip=function(t){if(this.isHovering){this.tooltipElement.style.display="block",this.tooltipElement.innerHTML=this.opt.onSetDayTooltip?this.opt.onSetDayTooltip(t):t.date,this.tooltipElement.style.left="0px";var e=this.tooltipElement.clientHeight,o=this.tooltipElement.clientWidth,i=t.coord.x+2*this.opt.cellSize-this.tooltipElement.clientWidth/2;this.tooltipElement.style.left=i+this.tooltipElement.clientWidth>this.element.clientWidth?this.opt.cellSize+(this.element.clientWidth-o)+"px":0>i?this.opt.cellSize+"px":i+"px",this.tooltipElement.style.top=t.coord.y-e+"px"}},S.prototype.setDimensions=function(){this.elementWidth=this.containerWidth-this.opt.cellSize-this.opt.padding,this.elementHeight=this.numRows*(this.opt.cellSize+this.opt.padding)-this.opt.padding,this.opt.container.style.height=(this.numRows+1)*(this.opt.cellSize+this.opt.padding)-this.opt.padding+"px"},S.prototype.draw=function(t){var e=this.opt.container.clientWidth;return!t&&(this.containerWidth==e||isNaN(e)||1>e)?!1:(this.containerWidth=e,this.setDimensions(),this.renderer.setDimensions(this.elementWidth,this.elementHeight),this.populateDays(),this.opt.onPopulateDaysFinished&&this.opt.onPopulateDaysFinished(this.days),this.drawDayNames&&this.drawDayNames(),this.drawMonthNames&&this.drawMonthNames(this.days),this.renderer.resetDays(),void this.renderer.drawDays(this.days))},S.prototype.populateDays=function(){},S.prototype.drawDayNames=function(){},S.prototype.drawMonthNames=function(){};var M=t(S,function(t){this.numRows=7,S.call(this,t)});M.prototype.populateDays=function(){var t=new Date(this.opt.date),o=new Date(this.opt.date),n=0,s=this.opt.cellSize+this.opt.padding,r=[],a=[],h=d(this.element,this.opt.padding,this.opt.cellSize+this.opt.padding);if("right"==this.opt.expandFrom)t.setDate(t.getDate()+7*h);else if("left"==this.opt.expandFrom)o.setDate(o.getDate()-7*h);else{h/=2;var l=h,p=h;h%1!==0&&(l=h+.5,p=h-.5),o.setDate(o.getDate()-7*l),t.setDate(t.getDate()+7*p)}o.setDate(o.getDate()-e(o)),t.setDate(t.getDate()+(6-e(t)));for(o.getMonth();t>=o;){if(!(this.opt.startDate&&date>=this.opt.startDate)||this.opt.stopDate&&date>=this.opt.stopDate){var c=new Date(o);a.push({date:c,coord:{x:n*s,y:e(c)*s,w:this.opt.cellSize,h:this.opt.cellSize},week:i(c)})}o.setDate(o.getDate()+1),n+=0===e(o)?1:0}this.days=a,this.months=r},M.prototype.drawDayNames=function(t){if(!t&&!this.dayNamesElement){var e=s(null,"div.day-names",null,this.opt.container);e.style.top=this.opt.cellSize+this.opt.padding+"px",e.style.width=this.opt.cellSize+"px",e.style.height=this.elementHeight+"px";{this.opt.cellSize+this.opt.padding}for(var o in D){var i=s(null,"div.day-name",null,e);i.innerHTML=o%2?"&nbsp;":D[o]}this.dayNamesElement=e}},M.prototype.drawMonthNames=function(t){this.monthNamesElement||(this.monthNamesElement=s(null,"div.month-names",null,this.opt.container),this.monthNamesElement.style.height=this.opt.cellSize+"px"),this.monthNamesElement.style.width=this.elementWidth+"px",n(this.monthNamesElement);for(var e in t){var o=t[e];if(15===o.date.getDate()){var i=s(null,"div.month-name",null,this.monthNamesElement);this.opt.onDrawMonthName&&this.opt.onDrawMonthName(o.date,i),i.style.left=o.coord.x+"px",i.textContent=m[o.date.getMonth()],this.elementWidth-(o.coord.x+i.clientWidth)<this.opt.cellSize&&i.parentNode.removeChild(i)}}};var N=t(S,function(t){this.numRows=6,S.call(this,t)});N.prototype.populateDays=function(){var t=new Date(this.opt.date),o=new Date(this.opt.date),n=0,s=0,r=[],a=[],h=this.opt.cellSize+this.opt.padding,l=c(this.element,this.opt.padding,this.opt.cellSize+this.opt.padding);if("right"==this.opt.expandFrom)t.setMonth(t.getMonth()+l);else if("left"==this.opt.expandFrom)o.setMonth(o.getMonth()-l);else{l/=2;var p=l,d=l;l%1!==0&&(p=l+.5,d=l-.5),o.setMonth(o.getMonth()-p),t.setMonth(t.getMonth()+d)}o.setDate(1),t=new Date(t.getFullYear(),t.getMonth()+1,0);for(var f=o.getMonth();t>=o;){if(f!=o.getMonth()&&(s=0,n+=7*h+h,f=o.getMonth()),!(this.opt.startDate&&date>=this.opt.startDate)||this.opt.stopDate&&date>=this.opt.stopDate){var y=new Date(o);a.push({date:y,coord:{x:n+e(y)*h,y:s*h,w:this.opt.cellSize,h:this.opt.cellSize},week:i(y)})}o.setDate(o.getDate()+1),s+=0===e(o)?1:0}this.days=a,this.months=r},N.prototype.drawMonthNames=function(t){this.monthNamesElement||(this.monthNamesElement=s(null,"div.month-names",null,this.opt.container),this.monthNamesElement.style.height=this.opt.cellSize+"px"),this.monthNamesElement.style.width=this.elementWidth+"px",n(this.monthNamesElement);var o;for(var i in t){var r=t[i];if(o!=r.date.getMonth()){o=r.date.getMonth();var a=s(null,"div.month-name",null,this.monthNamesElement);this.opt.onDrawMonthName&&this.opt.onDrawMonthName(r.date,a);var h=r.coord.x-e(r.date)*(this.opt.cellSize+this.opt.padding);a.style.left=h+"px",a.textContent=m[r.date.getMonth()]+" "+r.date.getFullYear(),this.elementWidth-(r.coord.x+a.clientWidth)<this.opt.cellSize&&a.parentNode.removeChild(a)}}},this.Tycal=function(t){if(!t.type||"week"==t.type){var e=new M(t);return e}return"month"==t.type?new N(t):void 0},this.Tycal.globals=x}).call(this);